<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="#">
    <title>SLR</title>
    <link rel="shortcut icon" href="/static/ok.png" type="image/png">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>
    <script src="https://webrtc.github.io/adapter/adapter-latest.js" crossorigin="anonymous"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">

    <script src="/static/js/task2_script.js"></script>

    <script type="text/javascript">
        var $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
        var intervalID = setInterval(update_values, 1000);
        var taskStarted = false;
        var task2Server = {{ request.script_root|tojson|safe }} + '/getTask2Response';
        var taskTyping = true;
        var showTweet = true;
        var totalTasks = 16;
        var taskResponse = {};

        var survey_link = 'https://docs.google.com/forms/d/e/1FAIpQLSeZtch5xA8JUKQioa-EQoQIccS_zsc1Yw1RM_YPkwpFN4dN-Q/viewform?usp=pp_url&entry.1722510161='


        function update_values() {
          $.getJSON($SCRIPT_ROOT + '/_task-stuff',

          function(data) {
              console.log(data)
              showTweet = data.showTweet;
              taskTyping = data.taskTyping;

              taskResponse = {
                'image_name': data.img_path,
                'question': data.question,
                'tweet': encodeURIComponent(data.tweet),
                'label': data.showTweet ? data.tweet_label : data.ans,
              };

              setCookie('task_count', (parseInt(getCookie('task_count')) + 1).toString());
              if (parseInt(getCookie('task_count')) == totalTasks){
                console.log("############################");
                setCookie('task_finish', 'true');
              }


              if (!data.showTask1){
                clearInterval(intervalID);
              }
              if (!data.taskFinish){
                $('#timeKeep').text(data.timeKeep);
                if (!data.showButton){
                    $("#showVid").click();
                }

                if (data.showTweet){
                    $('#tweet').text(data.tweet);
                    $('#tweet-area').show();
                    $('#vqa-area').hide();
                    if(!data.showTask1 && !data.taskTyping) {
                        $('#optionArea1').hide();
                        $('#optionArea2').show();
                    }
                }
                else{
                    $('#img_path').attr('src',data.img_path);
                    if(data.showTask1){
                        $('#question').text(data.question);
                    }
                    else{
                        $('#question').text(data.question + " yes, no or maybe?");
                    }
                    $('#tweet-area').hide();
                    $('#vqa-area').show();
                    if(!data.showTask1 && !data.taskTyping) {
                        $('#optionArea1').show();
                        $('#optionArea2').hide();
                    }
                }
                $('#response').text(data.sentence.toString());
              }
              else{
                if(!data.tryMode && data.showTask1){
                    $('#stop-area').show();
                    $('#task-area').hide();
                    $("#stop").click();
                }
                else if(!data.showTask1){
                    $('#stop-area').show();
                    $('#task-area').hide();
                    $("#stop").click();
                }
                else{ // things to do when task is finished in tryMode
                    console.log('###################################3');
                    $('#trySend').click();
                    $('#task-area').hide();
                    $('#info-section').show();
                }
              }
          });
        };
    </script>

    <button type="button" id="showVid" style="opacity:0;"></button>
</head>

<body class="bg-dark" onload="update_values();" data-url="{{ url_for('home') }}">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
                integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
                crossorigin="anonymous"></script>
    <div class="container-fluid">
        <h1>Complete the following Classification Task {% if showTask1 %} Using American Sign Language (ASL) {% endif %}</h1>

        <div class="container text-area">
            This task batch consists of two types of tasks - <strong>Visual Question Answering</strong>,
            and <strong>Tweet Sentiment Classification</strong>.
            In total, there will be {{total_num_tasks}} tasks in the batch,
            which will contain tasks of both types. For each task, you are required to answer a question
            based on the task. After answering the question, click "NEXT" to go on to the next question.
            <div>
                <strong style="text-decoration:underline;">Visual Question Answering</strong> -
                In this task, a picture will be shown to you.
                Along with the picture, there will be a question regarding the picture
                (e.g., 'Do you see a body of water in the picture?').
                The answer to the question will be a "YES", "NO" or "MAYBE".
                <br/>
                <strong style="text-decoration:underline;">Tweet Sentiment Classification</strong> -
                In this task, a text/tweet will be shown to you.
                You will be required to assess the sentiment of the text/tweet
                (for e.g., "This time tomorrow...we'll have the Iron on.
                Iron Maiden pieces Drops tomorrow nights.") by choosing one of "POSITIVE",
                "NEGATIVE" or "NEUTRAL" options.
            </div>
        </div>

        {% if showButton %}
        <!--     Start id info-section       -->
        <div id="info-section">
            <div class="container terms-conditions" id="terms-conditions">
                <input type="checkbox" id="tnc" name="tnc" value="TC" onchange="document.getElementById('start').disabled = !this.checked;">
                <label for="tnc"> By ticking, I confirm that I have read the instructions to complete the task and
                    will honestly take part in this study.
                    {% if showTask1 %}
                        Also, we assure that image/video from the camera
                        will NOT be stored in any form.
                    {% endif %}
                    Any type of data shared during the task, will solely be
                    kept for the task and will NOT be shared.
                </label>
            </div>
            <div id="start-area" style="margin-top: 5%;margin-bottom: 5%;">
                <form method="post" action="/home">
                    <div class="container col-md-4 d-grid">
                        <button class="btn btn-primary" type="submit" id="start" disabled>START</button>
                    </div>
                </form>
            </div>
        </div>
        <!--     End id info-section       -->

        {% else %}
        <div id="stop-area" style="margin-top: 2%; display: none;">
            <div class="container col-md-4 d-grid">
                <button class="btn btn-danger" type="button" id="stop">STOP</button>
            </div>
        </div>
        <div id="done-area" style="margin-top: 2%; display: none;">
            <div class="container col-md-4 d-grid">
                <button class="btn btn-success" id="done" disabled>DONE</button>
            </div>
            <div class="container thanks-area">
                <p>Thank you very much for your participation.
                    Now, please complete a small survey to give us a better idea of your task experience.
                    Click here to go to the <a href={{survey_link}} rel="noopener" id="surveyLink">survey</a>.
                    If for any reason the above link does not work, you can also use this link:
                    <a href="https://forms.gle/8YHeg4BwRvXPUTTN7" rel="noopener">https://forms.gle/8YHeg4BwRvXPUTTN7</a>
                    After the completion of the survey, we will provide you the completion link/code.</p>
            </div>
        </div>

        <!--     Start id task-area       -->
        <div id="task-area" class="container-fluid" >
            <div class="row">
                <div class="col">
                    <div id="tweet-area">
                        <div class="tweet bottom-left" id="tweet">{{ tweet }}</div>
                        <div class="question bottom-left">Do you think this statement is Positive,
                            Negative or Neutral?</div>
                    </div>
                    <div id="vqa-area" style="margin-top: 60px;">
                        <img id="img_path" src="{{ img_path }}" width="55%" height="60%" alt="Image to Answer."/>
                        <div class="question bottom-left" id="question"></div>
                    </div>
                    {% if not showTask1 %}
                    <div class="text-response-area" style="margin-bottom: 50px;">
                        <label for="text_response" style="font-size: 29px;margin-right: 20px;">Response:</label>

                        {% if taskTyping %}

                        <input type="text" id="text_response" name="text_response" onkeyup="EnableDisable(this)">

                        {% else %}

                        <div id="optionArea1" class="btn-group" role="group" aria-label="Basic radio toggle button group" style="margin-right: 20px;">
                          <input type="radio" class="btn-check" name="btnradio" id="option1" autocomplete="off" value="yes">
                          <label class="btn btn-outline-success" for="option1">YES</label>

                          <input type="radio" class="btn-check" name="btnradio" id="option2" autocomplete="off" value="no">
                          <label class="btn btn-outline-danger" for="option2">NO</label>

                          <input type="radio" class="btn-check" name="btnradio" id="option3" autocomplete="off" value="maybe">
                          <label class="btn btn-outline-warning" for="option3">MAYBE</label>
                        </div>

                        <div id="optionArea2" class="btn-group" role="group" aria-label="Basic radio toggle button group" style="margin-right: 20px;">
                          <input type="radio" class="btn-check" name="btnradio2" id="option4" autocomplete="off" value="positive">
                          <label class="btn btn-outline-success" for="option4">POSITIVE</label>

                          <input type="radio" class="btn-check" name="btnradio2" id="option5" autocomplete="off" value="negative">
                          <label class="btn btn-outline-danger" for="option5">NEGATIVE</label>

                          <input type="radio" class="btn-check" name="btnradio2" id="option6" autocomplete="off" value="neutral">
                          <label class="btn btn-outline-warning" for="option6">NEUTRAL</label>
                        </div>
                        {% endif %}
                        <button type="button" class="btn btn-success" id="nextButton" disabled> NEXT </button><br>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        <!--     End id task-area       -->
        {% endif %}
    </div>
</body>
</html>